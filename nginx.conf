# nginx configuration for GAE docker container

events {}

http {
    server {
        listen 8080;

        location ^~ /resumake/api/ {
            # https://serverfault.com/a/870620
            proxy_pass http://localhost:3001/api/;
        }

        location ~ ^/resumake($|/.*$) {
            root /resumake-client-bundle;

            # Resumake doesn't use hash-based routing, which
            # sometimes causes 404 on refresh (we don't have e.g. "/generate" endpoint).
            # In other words, 404 in a way becomes a client thing...
            try_files $uri $uri/ /resumake/index.html;
        }
    }
}
